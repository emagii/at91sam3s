<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SAM3S Software Package: USB HID Basic</title>
<link href="common/style.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
    <div id="body">
        <div id="title">SAM3S Software Package 2.1</div>
        <div id="banner"></div>

<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="usb_library.html">USB Library</a>      </li>
      <li><a class="el" href="usbd_framework.html">AT91 USB device framework</a>      </li>
      <li><a class="el" href="usbd_hid_kbd_drv.html">USB Device HID Keyboard Driver</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>USB HID Basic </h1>  </div>
</div>
<div class="contents">
<p>This page gives generic details on the HID class, including its purpose, architecture and how it is supported by various operating systems.</p>
<h2><a class="anchor" id="Purpose"></a>
Purpose</h2>
<p>The HID class has been specifically designed for Human Interface Devices, i.e., devices which are manipulated by humans to control a computer or an electronic device. This includes common peripherals such as a keyboard, a mouse or a joystick, as well as many other interfaces: remote controllers, switches, buttons, dedicated game controls, and so on.</p>
<p>It is also possible to use the HID class for devices which do not require human interaction, but still deliver information in a similar format. For example, devices like a thermometer or a battery indicator are supported.</p>
<p>In addition, the HID class also makes it possible to not only receive data from devices but also to send commands to them. Indeed, many devices offer some kind of display to give back information to the user, e.g., the LEDs on a keyboard.</p>
<p>Finally, since it is quite simple to send and receive data using the HID class, it can be used as a generic means of communication between a device and a host. This is made possible because of the very flexible framework defined in the HID specification.</p>
<p>In this document, three uses of the HID class will be detailed step-by-step, each showing one particular feature of the class. The first example shows the interaction with a simple mouse. In the second example, a keyboard is implemented to demonstrate the possibility to send data to a peripheral. The last example explains how to use HID as a simple two-way communication channel.</p>
<h2><a class="anchor" id="Architecture"></a>
Architecture</h2>
<h3><a class="anchor" id="Interface"></a>
Interface</h3>
<p>An HID device only needs <b>one interface descriptor</b>. It should have the HID interface class code in its bInterfaceClass field. There are special subclass and protocol codes to specify if the HID device is a mouse or a keyboard, and must be supported by the BIOS. In such a case, the interface must be declared as a Boot Interface, and the type of the device (mouse or keyboard) must be given in the bInterfaceProtocol field.</p>
<h3><a class="anchor" id="Endpoints"></a>
Endpoints</h3>
<p>Up to three endpoints can be used with an HID interface. The first two are the default Control endpoint 0, as well as an Interrupt IN endpoint. They are mandatory and shall always be declared. An optional Interrupt OUT endpoint can be added as well.</p>
<p><a class="el" href="struct_endpoint.html">Endpoint</a> 0 is used for class-specific requests, as well as receiving data from the host if no Interrupt OUT endpoint has been defined. In addition, the host can also explicitly request or send report data through this endpoint.</p>
<p>The Interrupt IN and OUT pipes are used for sending asynchronous data to the host, and to receive low-latency information.</p>
<div align="center">
<img src="HIDClassArch.png" alt="HIDClassArch.png"/>
<p><strong>HID Class Driver Architecture</strong></p></div>
 <h3><a class="anchor" id="class_spec_desc"></a>
Class-specific Descriptors</h3>
<p>There are three class-specific descriptors defined in the <em>HID specification 1.11</em>: the HID descriptor, the report descriptor and the physical descriptor.</p>
<h4><a class="anchor" id="hid_descr"></a>
HID Descriptor</h4>
<p>The HID descriptor gives information about the HID specification revision used, the country for which a device is localized, and lists the number of class-specific descriptors, including their length and type.</p>
<p>HID Descriptor Format</p>
<table class="doxtable">
<tr>
<td><b>Field</b> </td><td><b>Size(bytes)</b> </td><td><b>Description</b> </td></tr>
<tr>
<td>bLength </td><td>1 </td><td>Total length of the HID descriptor </td></tr>
<tr>
<td>bDescriptorType </td><td>1 </td><td>HID descriptor type (21h) </td></tr>
<tr>
<td>bcdHID </td><td>2 </td><td>HID specification release number in BCD format </td></tr>
<tr>
<td>bCountryCode </td><td>1 </td><td>Code of the country for which the device is located.<br/>
Should be 0 if the device is not localized. </td></tr>
<tr>
<td>bNumDescriptors </td><td>1 </td><td>Number of class-specific descriptors used by the device. </td></tr>
<tr>
<td>bDescriptorType </td><td>1 </td><td>Type of the first class-specific descriptor. </td></tr>
<tr>
<td>bDescriptorLength </td><td>1 </td><td>Total length of the first class-specific descriptor. </td></tr>
<tr>
<td>[bDescriptorType] </td><td>1 </td><td>Type of the second class-specific descriptor. </td></tr>
<tr>
<td>[bDescriptorLength] </td><td>1 </td><td>Total length of the second class-specific descriptor. </td></tr>
<tr>
<td>... </td><td></td><td></td></tr>
</table>
<p>There is always at least one Report descriptor for an HID device, so the corresponding fields must be present in the HID descriptor. If other descriptors are defined, they must also be described here.</p>
<h4><a class="anchor" id="hid_rep_descr"></a>
Report Descriptor</h4>
<p>A HID device must have at least one <b>Report descriptor</b>. It defines the type of data manipulated by the device, which is referred to as report. When the device wants to notify that the cursor has moved, for example, it sends the corresponding report in the format previously defined in the Report descriptor.</p>
<p>This descriptor is quite different from others, as it does not have a fixed table of values. Instead, it is made up of a variable number of items, which collectively identify the information that a host can expect from or send to the device.</p>
<p>There are five categories of items:</p>
<ul>
<li><b>Input</b> items, which define the format and type of the data sent by the device.</li>
<li><b>Output</b> items, which define the format and type of the data expected by the device</li>
<li><b>Feature</b> items, which define data sent to or received from the device, and not intended for the end user, such as configuration parameters.</li>
<li><b>Collection</b> items, which identify a set of data as related to the same group.</li>
<li><b>End Collection</b> items, which close other Collection items.</li>
</ul>
<p>Usually, a Report descriptor defines only one use (report) for a device, e.g., a mouse. However, it is possible to declare several reports to perform different tasks, e.g., mouse &amp; keyboard. This is done by assigning a different <b>Report ID</b> to each report; this makes it possible for the device to send both reports through the same Interrupt endpoint, while still permitting the host to correctly identify the data. Using only a single endpoint for several functionalities is very powerful, as the remaining ones can then be used by other interfaces (CDC, MSD, etc.) for an even more versatile device.</p>
<p>More details about Report descriptors will be given in the implementation examples. For more information about the possible items, tags and values, please refer to the <em>HID specification 1.11.</em></p>
<h4><a class="anchor" id="hid_phy_descr"></a>
Physical Descriptor</h4>
<p>A <b>Physical descriptor</b> can be used to give information about which human body part is used to activate a particular control. While this is a useless piece of information for most devices, it can be relevant for complex devices which provide many similar controls. In such a case, a Physical descriptor allows an application to assign its functionalities more appropriately; for example, a game controller often has a large number of buttons, with some of them more accessible than the others. Those buttons would be assigned the most useful actions.</p>
<p>Since physical descriptors are not used very often, and are not useful in the case studies described in this document, they will not be discussed further.</p>
<h3><a class="anchor" id="class_spec_req"></a>
Class-specific requests</h3>
<h4><a class="anchor" id="GetDescriptor"></a>
GetDescriptor</h4>
<p>While <b>GET_DESCRIPTOR</b> is a standard request (defined in the }USB specification 2.0}), new descriptor type values have been added for the HID class. They make it possible for the host to request the HID descriptor, Report descriptor and Physical descriptors used by the device.</p>
<p>When requesting a HID-specific descriptor, the <em>wIndex</em> field of the request must be set to the HID interface number. For standard requests, this field is either set to 0 or, for String descriptors, to the index of the language ID used.</p>
<h4><a class="anchor" id="SetDescriptor"></a>
SetDescriptor</h4>
<p>Similarly, <b>SET_DESCRIPTOR</b> is a standard request with added HID-specific values. It is used by the host to change the HID descriptors of a device. This is an optional request, and has few practical uses.</p>
<h4><a class="anchor" id="GetReport"></a>
GetReport</h4>
<p>The host can explicitly ask the device for a report by using the <b>GET_REPORT</b> request. However, it should be used primarily to get the state of feature items and absolute values at initialization time, not for consistent device polling.</p>
<p>The requested report is identified either by its Report ID (if they are used), and/or by its type (Input, Output or Feature).</p>
<p>Please note that a GET_REPORT request is different from a GET_DESCRIPTOR request for the Report descriptor. The latter returns the whole Report descriptor, i.e., all the items declared. The former returns the data defined by this descriptor.</p>
<h4><a class="anchor" id="SetReport"></a>
SetReport</h4>
<p><b>SET_REPORT</b> is similar to GET_REPORT, except this request is used for changing the state of a report, instead of simply retrieving it.</p>
<p>For an Input report, this request can either be considered meaningless, or can be used to reset the current status of a control. For example, it could be used to calibrate the neutral position of a joystick.</p>
<h4><a class="anchor" id="SetIdle"></a>
SetIdle</h4>
<p>This request is used to specify the minimum amount of time, called <b>Idle rate</b>, that a device must wait before transmitting a report if its state has not changed. This means the device must NAK all polls on its Interrupt IN endpoint until the report state changes, or the guarding period expires.</p>
<p>The SET_IDLE command can either be issued for a particular duration, or for an undefined period of time. The upper byte of the wValue field is used to specify this duration. In addition, if the device generates multiple reports, the Report ID of the target report to affect can be specified in the lower byte.</p>
<p>In practice, this request is often used with a keyboard to put a small delay before a key is repeated continuously. For a mouse, it must be set to 0, meaning that the device should never report an unchanged state.</p>
<h4><a class="anchor" id="GetIdle"></a>
GetIdle</h4>
<p>The GET_IDLE request is issued by the host to retrieve the current Idle rate of the device. A particular Report can be specified with its Report ID.</p>
<h4><a class="anchor" id="GetProtocol"></a>
GetProtocol</h4>
<p>This request returns the protocol currently used by the device. This can either be the Report protocol (}wValue} set to 0) or the Boot protocol (}wValue} set to 1). Since a device supporting the Boot protocol can operate differently depending on which mode it is in, the host system can retrieve or change this mode with the GET_PROTOCOL and SET_PROTOCOL requests.</p>
<p>This request is only need for devices supporting the Boot protocol.</p>
<h4><a class="anchor" id="SetProtocol"></a>
SetProtocol</h4>
<p>Whenever an HID device starts up, it should use the Report protocol by default. However, the host driver shall still use the SET_PROTOCOL request to specify if the device should use the Report protocol or the Boot protocol.</p>
<h2><a class="anchor" id="host_drv"></a>
Host Drivers</h2>
<p>Most operating systems provide a generic HID driver which automatically handles standard devices, such as keyboard, mice and joystick. In addition, the driver can also be used by the application to easily access custom and vendor-specific devices. </p>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
